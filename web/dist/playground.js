var f=class{canvas;ctx;config;buffer;cursorX=0;cursorY=0;cursorVisible=!0;cursorBlinkInterval=null;constructor(t){if(this.canvas=document.getElementById(t),!this.canvas)throw new Error(`Canvas element with id "${t}" not found`);let e=this.canvas.getContext("2d",{alpha:!1});if(!e)throw new Error("Failed to get 2D context");this.ctx=e,this.config={cols:120,rows:80,fontSize:14,fontFamily:"JetBrains Mono",charWidth:0,charHeight:0,backgroundColor:"#24273a",foregroundColor:"#cad3f5"},this.initialize(),this.buffer=this.createBuffer(),this.startCursorBlink()}initialize(){this.ctx.font=`${this.config.fontSize}px ${this.config.fontFamily}`;let t=this.ctx.measureText("M");this.config.charWidth=t.width,this.config.charHeight=Math.ceil(this.config.fontSize*1.5),this.canvas.width=this.config.cols*this.config.charWidth,this.canvas.height=this.config.rows*this.config.charHeight,this.ctx.font=`${this.config.fontSize}px ${this.config.fontFamily}`,this.ctx.textBaseline="top",this.ctx.textAlign="left"}createBuffer(){let t=[];for(let e=0;e<this.config.rows;e++){t[e]=[];for(let s=0;s<this.config.cols;s++)t[e][s]={char:" ",fg:this.config.foregroundColor,bg:this.config.backgroundColor}}return t}startCursorBlink(){this.cursorBlinkInterval=window.setInterval(()=>{this.cursorVisible=!this.cursorVisible,this.renderCursor()},500)}clear(){this.buffer=this.createBuffer(),this.cursorX=0,this.cursorY=0,this.render()}writeChar(t,e,s){let o=e??this.cursorX,i=s??this.cursorY;i>=0&&i<this.config.rows&&o>=0&&o<this.config.cols&&(this.buffer[i][o]={char:t,fg:this.config.foregroundColor,bg:this.config.backgroundColor},this.renderCell(o,i)),e===void 0&&s===void 0&&(this.cursorX++,this.cursorX>=this.config.cols&&(this.cursorX=0,this.cursorY++,this.cursorY>=this.config.rows&&this.scroll()))}write(t){for(let e of t)e===`
`?(this.cursorX=0,this.cursorY++,this.cursorY>=this.config.rows&&this.scroll()):e==="\r"?this.cursorX=0:this.writeChar(e);this.renderCursor()}writeLine(t){this.write(t+`
`)}scroll(){for(let t=0;t<this.config.rows-1;t++)this.buffer[t]=this.buffer[t+1];this.buffer[this.config.rows-1]=[];for(let t=0;t<this.config.cols;t++)this.buffer[this.config.rows-1][t]={char:" ",fg:this.config.foregroundColor,bg:this.config.backgroundColor};this.cursorY=this.config.rows-1,this.render()}renderCell(t,e){let s=this.buffer[e][t],o=t*this.config.charWidth,i=e*this.config.charHeight;this.ctx.fillStyle=s.bg,this.ctx.fillRect(o,i,this.config.charWidth,this.config.charHeight),this.ctx.fillStyle=s.fg,this.ctx.fillText(s.char,o,i)}renderCursor(){let t=this.cursorX*this.config.charWidth,e=this.cursorY*this.config.charHeight;this.renderCell(this.cursorX,this.cursorY),this.cursorVisible&&(this.ctx.fillStyle=this.config.foregroundColor,this.ctx.fillRect(t,e+this.config.charHeight-2,this.config.charWidth,2))}render(){this.ctx.fillStyle=this.config.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);for(let t=0;t<this.config.rows;t++)for(let e=0;e<this.config.cols;e++)this.renderCell(e,t);this.renderCursor()}setCursor(t,e){this.cursorX=Math.max(0,Math.min(t,this.config.cols-1)),this.cursorY=Math.max(0,Math.min(e,this.config.rows-1)),this.render()}getCursor(){return{x:this.cursorX,y:this.cursorY}}destroy(){this.cursorBlinkInterval!==null&&clearInterval(this.cursorBlinkInterval)}};var d=class{console;config;currentLine="";cursorPosition=0;promptLength=0;history=[];historyIndex=-1;constructor(t,e){this.console=t,this.config=e,this.promptLength=e.promptSymbol.length,this.setupKeyboardListeners()}setupKeyboardListeners(){document.addEventListener("keydown",t=>{this.handleKeyDown(t)})}handleKeyDown(t){switch(["Enter","Backspace","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","Delete"].includes(t.key)&&t.preventDefault(),t.key){case"Enter":this.handleSubmit();break;case"Backspace":this.handleBackspace();break;case"Delete":this.handleDelete();break;case"ArrowLeft":this.handleArrowLeft();break;case"ArrowRight":this.handleArrowRight();break;case"ArrowUp":this.handleArrowUp();break;case"ArrowDown":this.handleArrowDown();break;case"Home":this.handleHome();break;case"End":this.handleEnd();break;default:t.key.length===1&&!t.ctrlKey&&!t.metaKey&&!t.altKey&&this.handleCharacterInput(t.key);break}}handleCharacterInput(t){this.currentLine=this.currentLine.slice(0,this.cursorPosition)+t+this.currentLine.slice(this.cursorPosition),this.cursorPosition++,this.redrawLine()}handleBackspace(){this.cursorPosition>0&&(this.currentLine=this.currentLine.slice(0,this.cursorPosition-1)+this.currentLine.slice(this.cursorPosition),this.cursorPosition--,this.redrawLine())}handleDelete(){this.cursorPosition<this.currentLine.length&&(this.currentLine=this.currentLine.slice(0,this.cursorPosition)+this.currentLine.slice(this.cursorPosition+1),this.redrawLine())}handleArrowLeft(){this.cursorPosition>0&&(this.cursorPosition--,this.updateCursorPosition())}handleArrowRight(){this.cursorPosition<this.currentLine.length&&(this.cursorPosition++,this.updateCursorPosition())}handleArrowUp(){this.history.length!==0&&(this.historyIndex===-1?this.historyIndex=this.history.length-1:this.historyIndex>0&&this.historyIndex--,this.currentLine=this.history[this.historyIndex],this.cursorPosition=this.currentLine.length,this.redrawLine())}handleArrowDown(){this.historyIndex!==-1&&(this.historyIndex<this.history.length-1?(this.historyIndex++,this.currentLine=this.history[this.historyIndex]):(this.historyIndex=-1,this.currentLine=""),this.cursorPosition=this.currentLine.length,this.redrawLine())}handleHome(){this.cursorPosition=0,this.updateCursorPosition()}handleEnd(){this.cursorPosition=this.currentLine.length,this.updateCursorPosition()}handleSubmit(){let t=this.currentLine;t.trim().length>0&&(this.history.push(t),this.historyIndex=-1),this.console.write(`
`),this.config.onSubmit(t),this.currentLine="",this.cursorPosition=0,this.showPrompt()}redrawLine(){let e=this.console.getCursor().y;this.console.setCursor(this.promptLength,e);let s=" ".repeat(120-this.promptLength);this.console.write(s),this.console.setCursor(this.promptLength,e),this.console.write(this.currentLine),this.updateCursorPosition()}updateCursorPosition(){let t=this.console.getCursor();this.console.setCursor(this.promptLength+this.cursorPosition,t.y)}showPrompt(){this.console.write(this.config.promptSymbol)}};var I=/(?:"(?<quoted>[^"]*)"|(?<number>-?\d+\.?\d*)|(?<seal>[^\w\s"]+)|(?<string>\S+)|(?<append>\s+))/g;function x(r){return new w(r).start()}function C(r){return r instanceof u?r.LineView():r.View()}function D(){console.log("=== Barry Parser Tests ===");let r=["1234","  42.5  ","-7","12 34","12 (34 56) 78","12s","12s 34s","#123","#12s","12+34"];for(let t of r){console.log(`
Input: "${t}"`);try{let e=x(t);console.log(`  Result: ${C(e)}`)}catch(e){console.error(`  Error: ${e}`)}}console.log(`
=== Tests Complete ===`)}var P=new Map([["(",()=>new u],[")",()=>new a],["#",()=>new m],["+",()=>new b]]),k=new Map([["s",()=>new v]]),w=class{constructor(t){this.input=t;this.regex=new RegExp(I.source,I.flags)}regex;parseSeal(t,e){for(let s=t.length;s>0;s--){let o=t.substring(0,s);if(P.has(o)){let i=s;return this.regex.lastIndex=e-t.length+i,P.get(o)()}}throw new Error(`Unknown seal: ${t[0]}`)}start(){let t=new u;for(;;){let e=this.next(null,0);if(e===null)break;t.append(e)}return t.items.length===0?new p:t.items.length===1?t.items[0]:t}next(t,e){let s=this.regex.lastIndex,o=()=>{this.regex.lastIndex=s},i=this.regex.exec(this.input);for(;i&&i.groups?.append!==void 0;)i=this.regex.exec(this.input);if(!i||!i.groups)return o(),null;let n=null;if(i.groups.number!==void 0)n=new l(i.groups.number);else if(i.groups.quoted!==void 0)n=new g(i.groups.quoted);else if(i.groups.string!==void 0)k.has(i.groups.string)?n=k.get(i.groups.string)():n=new g(i.groups.string);else if(i.groups.seal!==void 0)n=this.parseSeal(i.groups.seal,this.regex.lastIndex);else return o(),null;if(console.log("Created idea:",n instanceof a?")":n.View()),t!==null){if(n.precedence<e)return o(),null;let c=n.consumePre(t);if(c===null)return o(),null;n=c}if(n instanceof a)return n;if(n instanceof u){for(;;){let c=this.next(null,0);if(c===null||c instanceof a)break;n.append(c)}n.items.length===0&&(n=new p)}if("consumePost"in n){let c=this.regex.lastIndex,V=()=>{this.regex.lastIndex=c},L=this.next(null,n.precedence);L!==null&&(n.consumePost(L)||V())}let y=this.next(n,e);return y!==null?y:n}},h=class{precedence=0;finished=!1;complete=!1;consumePre(t){return null}},l=class extends h{value;constructor(t){super(),this.value=parseFloat(t),this.complete=!0}View(){return this.value.toString()}},g=class extends h{value;constructor(t){super(),this.value=t,this.complete=!0}View(){return'"'+this.value+'"'}},u=class extends h{items=[];constructor(){super(),this.complete=!0}append(t){this.items.push(t)}View(){return"("+this.items.map(t=>t.View()).join(" ")+")"}LineView(){return this.items.map(t=>t.View()).join(" ")}},p=class extends h{constructor(){super(),this.complete=!0}View(){return"()"}},a=class extends h{constructor(){super()}View(){throw new Error("Closure should never appear in AST")}},m=class extends h{right=null;constructor(){super(),this.precedence=100}consumePost(t){return t instanceof l&&this.right===null?(this.right=t,this.complete=!0,!0):!1}View(){return"#"+(this.right===null?"_":this.right.View())}},v=class extends h{left=null;constructor(){super(),this.precedence=50}consumePre(t){return t instanceof l?(this.left=t,this.complete=!0,this):null}View(){return(this.left===null?"_":this.left.View())+"s"}},b=class extends h{left=null;right=null;constructor(){super(),this.precedence=10}consumePre(t){return t instanceof l?(this.left=t,this):null}consumePost(t){return t instanceof l?(this.right=t,this.left!==null&&(this.complete=!0),!0):!1}View(){let t=this.left===null?"_":this.left.View(),e=this.right===null?"_":this.right.View();return t+"+"+e}};function E(r,t,e){if(!r.trim()){e.showPrompt();return}try{let s=x(r),o=C(s);t.writeLine(o)}catch(s){t.writeLine("Error: "+s.message)}e.showPrompt()}async function A(){try{await document.fonts.load('14px "JetBrains Mono"'),console.log("JetBrains Mono font loaded")}catch(e){console.error("Failed to load font:",e)}let r=new f("terminal-canvas");r.clear(),r.writeLine("Barry - A Programming Language to Get Lucky"),r.writeLine("(_*_) "),r.writeLine("");let t=new d(r,{promptSymbol:"> ",onSubmit:e=>{E(e,r,t)}});t.showPrompt()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",A):A();
//# sourceMappingURL=playground.js.map
