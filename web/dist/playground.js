var d=class{cols=80;rows=24;fontSize;fontFamily="JetBrains Mono";charWidth=0;charHeight=0;canvas;ctx;bgColor="#24273a";fgColor="#cad3f5";statusBg="#1e2030";constructor(t,e=14){this.fontSize=e;let s=document.getElementById(t);if(!s||!(s instanceof HTMLCanvasElement))throw new Error(`Canvas element "${t}" not found`);this.canvas=s;let o=this.canvas.getContext("2d",{alpha:!1});if(!o)throw new Error("Failed to get 2D context");this.ctx=o,this.initialize()}initialize(){this.ctx.font=`${this.fontSize}px ${this.fontFamily}`;let t=this.ctx.measureText("M");this.charWidth=t.width,this.charHeight=Math.ceil(this.fontSize*1.5),this.canvas.width=this.cols*this.charWidth,this.canvas.height=this.rows*this.charHeight,this.ctx.font=`${this.fontSize}px ${this.fontFamily}`,this.ctx.textBaseline="middle",this.ctx.textAlign="left",this.clear()}clear(){this.ctx.fillStyle=this.bgColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}clearSource(){this.ctx.fillStyle=this.bgColor;let t=0,e=22*this.charHeight;this.ctx.fillRect(0,t,this.canvas.width,e)}clearStatus(){this.ctx.fillStyle=this.statusBg;let t=22*this.charHeight,e=this.charHeight;this.ctx.fillRect(0,t,this.canvas.width,e)}clearCommand(){this.ctx.fillStyle=this.bgColor;let t=23*this.charHeight,e=this.charHeight;this.ctx.fillRect(0,t,this.canvas.width,e)}drawText(t,e,s,o){if(s<1||s>this.rows||e<0||e>=this.cols)return;let n=e*this.charWidth,i=(s-1)*this.charHeight+this.charHeight/2;this.ctx.fillStyle=o,this.ctx.fillText(t,n,i)}drawStatus(t){this.clearStatus(),this.drawText(t,0,23,this.fgColor)}drawCommandLine(t,e,s){this.clearCommand();let o=0;for(let n of e){let i=t.slice(o,n.endIndex);this.drawText(i,o,24,n.color),o=n.endIndex}o<t.length&&this.drawText(t.slice(o),o,24,this.fgColor),this.drawCursor(s,24)}drawCursor(t,e){if(e<1||e>this.rows||t<0||t>=this.cols)return;let s=t*this.charWidth,o=e*this.charHeight-2;this.ctx.fillStyle=this.fgColor,this.ctx.fillRect(s,o,this.charWidth,2)}getCharWidth(){return this.charWidth}getCharHeight(){return this.charHeight}getCols(){return this.cols}getRows(){return this.rows}};var p=class{console;config;prompt="(_*_) ";currentLine="";cursorPosition=0;history=[];historyIndex=-1;constructor(t,e){this.console=t,this.config=e,this.setupKeyboardListeners(),this.redraw()}setupKeyboardListeners(){document.addEventListener("keydown",t=>{this.handleKeyDown(t)})}handleKeyDown(t){switch(["Enter","Backspace","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","Delete"," "].includes(t.key)&&t.preventDefault(),t.key){case"Enter":this.handleSubmit();break;case"Backspace":this.handleBackspace();break;case"Delete":this.handleDelete();break;case"ArrowLeft":this.handleArrowLeft();break;case"ArrowRight":this.handleArrowRight();break;case"ArrowUp":this.handleArrowUp();break;case"ArrowDown":this.handleArrowDown();break;case"Home":this.handleHome();break;case"End":this.handleEnd();break;default:t.key.length===1&&!t.ctrlKey&&!t.metaKey&&!t.altKey&&this.handleCharacterInput(t.key);break}}handleCharacterInput(t){this.currentLine=this.currentLine.slice(0,this.cursorPosition)+t+this.currentLine.slice(this.cursorPosition),this.cursorPosition++,this.redraw()}handleBackspace(){this.cursorPosition>0&&(this.currentLine=this.currentLine.slice(0,this.cursorPosition-1)+this.currentLine.slice(this.cursorPosition),this.cursorPosition--,this.redraw())}handleDelete(){this.cursorPosition<this.currentLine.length&&(this.currentLine=this.currentLine.slice(0,this.cursorPosition)+this.currentLine.slice(this.cursorPosition+1),this.redraw())}handleArrowLeft(){this.cursorPosition>0&&(this.cursorPosition--,this.redraw())}handleArrowRight(){this.cursorPosition<this.currentLine.length&&(this.cursorPosition++,this.redraw())}handleArrowUp(){this.history.length!==0&&(this.historyIndex===-1?this.historyIndex=this.history.length-1:this.historyIndex>0&&this.historyIndex--,this.currentLine=this.history[this.historyIndex],this.cursorPosition=this.currentLine.length,this.redraw())}handleArrowDown(){this.historyIndex!==-1&&(this.historyIndex<this.history.length-1?(this.historyIndex++,this.currentLine=this.history[this.historyIndex]):(this.historyIndex=-1,this.currentLine=""),this.cursorPosition=this.currentLine.length,this.redraw())}handleHome(){this.cursorPosition=0,this.redraw()}handleEnd(){this.cursorPosition=this.currentLine.length,this.redraw()}handleSubmit(){let t=this.currentLine;t.trim().length>0&&(this.history.push(t),this.historyIndex=-1),this.config.onSubmit(t),this.currentLine="",this.cursorPosition=0,this.redraw()}redraw(){let t=[],e=this.prompt+this.currentLine,s=this.prompt.length+this.cursorPosition;this.console.drawCommandLine(e,t,s)}updateDisplay(t){let e=this.prompt+this.currentLine,s=this.prompt.length+this.cursorPosition;this.console.drawCommandLine(e,t,s)}getCurrentLine(){return this.currentLine}};var I=/(?:"(?<quoted>[^"]*)"|(?<number>-?\d+\.?\d*)|(?<seal>[^\w\s"]+)|(?<string>\S+)|(?<append>\s+))/g;function x(r){return new w(r).start()}function v(r){return r instanceof c?r.LineView():r.View()}function R(){console.log("=== Barry Parser Tests ===");let r=["1234","  42.5  ","-7","12 34","12 (34 56) 78","12+34","1+2+3"];for(let t of r){console.log(`
Input: "${t}"`);try{let e=x(t);console.log(`  Result: ${v(e)}`)}catch(e){console.error(`  Error: ${e}`)}}console.log(`
=== Tests Complete ===`)}var L=new Map([["(",()=>new c],[")",()=>new l],["+",()=>new m]]),C=new Map([]),w=class{constructor(t){this.input=t;this.regex=new RegExp(I.source,I.flags)}regex;parseSeal(t,e){for(let s=t.length;s>0;s--){let o=t.substring(0,s);if(L.has(o)){let n=s;return this.regex.lastIndex=e-t.length+n,L.get(o)()}}throw new Error(`Unknown seal: ${t[0]}`)}start(){let t=new c;for(;;){let e=this.next(null,0);if(e===null)break;t.append(e)}return t.items.length===0?new f:t.items.length===1?t.items[0]:t}next(t,e){let s=this.regex.lastIndex,o=()=>{this.regex.lastIndex=s},n=this.regex.exec(this.input);for(;n&&n.groups?.append!==void 0;)n=this.regex.exec(this.input);if(!n||!n.groups)return o(),null;let i=null;if(n.groups.number!==void 0)i=new u(n.groups.number);else if(n.groups.quoted!==void 0)i=new g(n.groups.quoted);else if(n.groups.string!==void 0)C.has(n.groups.string)?i=C.get(n.groups.string)():i=new g(n.groups.string);else if(n.groups.seal!==void 0)i=this.parseSeal(n.groups.seal,this.regex.lastIndex);else return o(),null;if(console.log("Created idea:",i instanceof l?")":i.View()),t!==null){if(i.precedence<e)return o(),null;let h=i.consumePre(t);if(h===null)return o(),null;i=h}if(i instanceof l)return i;if(i instanceof c){for(;;){let h=this.next(null,0);if(h===null||h instanceof l)break;i.append(h)}i.items.length===0&&(i=new f)}if("consumePost"in i){let h=this.regex.lastIndex,k=()=>{this.regex.lastIndex=h},b=this.next(null,i.precedence);b!==null&&(i.consumePost(b)||k())}let y=this.next(i,e);return y!==null?y:i}},a=class{precedence=0;finished=!1;complete=!1;consumePre(t){return null}},u=class extends a{value;constructor(t){super(),this.value=parseFloat(t),this.complete=!0}View(){return this.value.toString()}},g=class extends a{value;constructor(t){super(),this.value=t,this.complete=!0}View(){return'"'+this.value+'"'}},c=class extends a{items=[];constructor(){super(),this.complete=!0}append(t){this.items.push(t)}View(){return"("+this.items.map(t=>t.View()).join(" ")+")"}LineView(){return this.items.map(t=>t.View()).join(" ")}},f=class extends a{constructor(){super(),this.complete=!0}View(){return"()"}},l=class extends a{constructor(){super()}View(){throw new Error("Closure should never appear in AST")}},m=class extends a{left=null;right=null;constructor(){super(),this.precedence=10}consumePre(t){return t instanceof u?(this.left=t,this):null}consumePost(t){return t instanceof u?(this.right=t,this.left!==null&&(this.complete=!0),!0):!1}View(){let t=this.left===null?"_":this.left.View(),e=this.right===null?"_":this.right.View();return t+"+"+e}};function S(r,t){if(r.trim())try{let e=x(r),s=v(e);t.drawStatus(s)}catch(e){t.drawStatus("Error: "+e.message)}}async function P(){try{await document.fonts.load('14px "JetBrains Mono"'),console.log("JetBrains Mono font loaded")}catch(e){console.error("Failed to load font:",e)}let r=new d("terminal-canvas",14),t=new p(r,{onSubmit:e=>{S(e,r)}});r.drawStatus("Barry v0.1.0 - Ready")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",P):P();
//# sourceMappingURL=playground.js.map
